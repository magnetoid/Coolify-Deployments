"use strict";var ue=Object.create;var R=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var me=Object.getOwnPropertyNames;var ge=Object.getPrototypeOf,he=Object.prototype.hasOwnProperty;var we=(s,e)=>{for(var t in e)R(s,t,{get:e[t],enumerable:!0})},G=(s,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of me(e))!he.call(s,a)&&a!==t&&R(s,a,{get:()=>e[a],enumerable:!(i=fe(e,a))||i.enumerable});return s};var y=(s,e,t)=>(t=s!=null?ue(ge(s)):{},G(e||!s||!s.__esModule?R(t,"default",{value:s,enumerable:!0}):t,s)),ve=s=>G(R({},"__esModule",{value:!0}),s);var Te={};we(Te,{activate:()=>ke,deactivate:()=>Ae});module.exports=ve(Te);var v=y(require("vscode"));var B=y(require("vscode")),U=class s{constructor(e){this.context=e;e.globalState.setKeysForSync([s.SERVER_URL_KEY])}static SERVER_URL_KEY="coolify.serverUrl";static TOKEN_KEY="coolify.token";static TOKEN_FALLBACK_KEY="coolify.token.fallback";static SECRETS_SUPPORTED_KEY="coolify.secretsSupported";secretsAvailable;async isConfigured(){let e=await this.getServerUrl(),t=await this.getToken();return!!e&&!!t}async getServerUrl(){let e=B.workspace.getConfiguration("coolify").get("serverUrl");return e&&e.trim()!==""?e.trim():this.context.globalState.get(s.SERVER_URL_KEY)}async getToken(){return await this.hasSecretsSupport()?this.context.secrets.get(s.TOKEN_KEY):this.context.globalState.get(s.TOKEN_FALLBACK_KEY)}async setServerUrl(e){await this.context.globalState.update(s.SERVER_URL_KEY,e)}async setToken(e){await this.hasSecretsSupport()?await this.context.secrets.store(s.TOKEN_KEY,e):(await this.context.globalState.update(s.TOKEN_FALLBACK_KEY,e),B.window.showWarningMessage("Coolify: Your editor does not support secure secret storage. Your API token has been stored without encryption. Consider upgrading your editor or using a `.env` file."))}async clearConfiguration(){await this.context.globalState.update(s.SERVER_URL_KEY,void 0),await this.hasSecretsSupport()?await this.context.secrets.delete(s.TOKEN_KEY):await this.context.globalState.update(s.TOKEN_FALLBACK_KEY,void 0)}async hasSecretsSupport(){if(this.secretsAvailable!==void 0)return this.secretsAvailable;try{await this.context.secrets.get("__coolify_probe__"),this.secretsAvailable=!0}catch{this.secretsAvailable=!1,console.warn("[Coolify] SecretStorage not available in this editor \u2014 using plaintext fallback.")}return this.secretsAvailable}};var k=y(require("vscode"));var u=class{constructor(e,t){this.baseUrl=e;this.token=t}async fetchWithAuth(e,t){let i=new AbortController,a=setTimeout(()=>i.abort(),15e3);try{let o=await fetch(`${this.baseUrl}${e}`,{...t,headers:{Authorization:`Bearer ${this.token}`,"Content-Type":"application/json",...t?.headers||{}},signal:i.signal});if(!o.ok)throw new Error(`API request failed (${o.status}): ${o.statusText}`);return await o.json()}finally{clearTimeout(a)}}async fetchVoid(e,t="GET"){let i=new AbortController,a=setTimeout(()=>i.abort(),15e3);try{let o=await fetch(`${this.baseUrl}${e}`,{method:t,headers:{Authorization:`Bearer ${this.token}`},signal:i.signal});if(!o.ok)throw new Error(`Request failed (${o.status}): ${o.statusText}`);return!0}finally{clearTimeout(a)}}async getApplications(){return this.fetchWithAuth("/api/v1/applications")}async getApplicationsByEnvironment(e,t){return(await this.fetchWithAuth(`/api/v1/projects/${e}/environment/${t}`)).applications??[]}async getApplicationLogs(e){let t=new AbortController,i=setTimeout(()=>t.abort(),15e3);try{let a=await fetch(`${this.baseUrl}/api/v1/applications/${e}/logs`,{headers:{Authorization:`Bearer ${this.token}`},signal:t.signal});if(!a.ok)throw new Error(`Failed to fetch logs: ${a.statusText}`);return await a.text()}finally{clearTimeout(i)}}async startApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/start`)}async stopApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/stop`)}async restartApplication(e){return this.fetchVoid(`/api/v1/applications/${e}/restart`)}async getDeployments(){return this.fetchWithAuth("/api/v1/deployments")}async getApplicationDeployments(e){return this.fetchWithAuth(`/api/v1/applications/${e}/deployments`)}async startDeployment(e){return this.fetchVoid(`/api/v1/deploy?uuid=${e}`)}async cancelDeployment(e){return this.fetchVoid(`/api/v1/deployments/${e}/cancel`,"POST")}async getProjects(){return this.fetchWithAuth("/api/v1/projects")}async getProjectEnvironments(e){return(await this.fetchWithAuth(`/api/v1/projects/${e}`)).environments??[]}async getServers(){return this.fetchWithAuth("/api/v1/servers")}async getDatabases(){return this.fetchWithAuth("/api/v1/databases")}async startDatabase(e){return this.fetchVoid(`/api/v1/databases/${e}/start`)}async stopDatabase(e){return this.fetchVoid(`/api/v1/databases/${e}/stop`)}async createDatabaseBackup(e){return this.fetchVoid(`/api/v1/databases/${e}/backup`,"POST")}async verifyToken(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{return(await fetch(`${this.baseUrl}/api/v1/version`,{headers:{Authorization:`Bearer ${this.token}`},signal:e.signal})).ok}catch{return!1}finally{clearTimeout(t)}}async testConnection(){let e=new AbortController,t=setTimeout(()=>e.abort(),5e3);try{return(await fetch(`${this.baseUrl}/api/health`,{signal:e.signal})).ok}catch{return!1}finally{clearTimeout(t)}}async getVersion(){let e=await this.fetchWithAuth("/api/v1/version");return typeof e=="string"?e:e.version??"unknown"}};var V=class{constructor(e){this.configManager=e}items=[];pollInterval;isDisposed=!1;async initialize(){await this.refreshStatusBar(),this.startPolling()}startPolling(){let e=k.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this.pollInterval=setInterval(async()=>{this.isDisposed||await this.refreshStatusBar()},e)}async refreshStatusBar(){if(this.isDisposed)return;let e=await this.configManager.isConfigured();if(this.clearItems(),!!e)try{let t=await this.configManager.getServerUrl(),i=await this.configManager.getToken();if(!t||!i)return;let o=await new u(t,i).getApplications(),r=k.workspace.getConfiguration("coolify").get("defaultApplication"),n=r?o.filter(c=>c.id===r||c.uuid===r):o.slice(0,2);for(let c of n){let d=k.window.createStatusBarItem(k.StatusBarAlignment.Left,100);d.name=`Coolify \u2014 ${c.name}`;let p=this.getStatusIcon(c.status);d.text=`${p} ${c.name}: ${this.formatStatus(c.status)}`,d.tooltip=new k.MarkdownString(`**Coolify App: ${c.name}**

Status: \`${c.status}\`

Click to view logs`),d.command={title:"View Logs",command:"coolify.viewApplicationLogs",arguments:[{id:c.id||c.uuid,name:c.name}]},this.applyStatusBackground(d,c.status),d.show(),this.items.push(d)}}catch(t){console.error("StatusBarManager: Failed to refresh:",t)}}getStatusIcon(e){switch(e?.toLowerCase()){case"running":return"$(vm-running)";case"stopped":case"exited":return"$(vm-outline)";case"deploying":case"starting":return"$(sync~spin)";case"error":case"failed":return"$(error)";default:return"$(circle-outline)"}}formatStatus(e){return e?e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," "):"Unknown"}applyStatusBackground(e,t){switch(t?.toLowerCase()){case"error":case"failed":e.backgroundColor=new k.ThemeColor("statusBarItem.errorBackground");break;case"deploying":case"starting":e.backgroundColor=new k.ThemeColor("statusBarItem.warningBackground");break;default:e.backgroundColor=void 0}}clearItems(){for(let e of this.items)e.dispose();this.items=[]}dispose(){this.isDisposed=!0,this.pollInterval&&clearInterval(this.pollInterval),this.clearItems()}};var l=y(require("vscode"));var m=class extends l.TreeItem{constructor(t,i,a,o,r){super(t,i);this.kind=a;this.rawData=o;this.parentId=r;this.applyKindConfig()}applyKindConfig(){switch(this.kind){case"project":this.iconPath=new l.ThemeIcon("folder"),this.contextValue="coolifyProject";break;case"environment":this.iconPath=new l.ThemeIcon("layers"),this.contextValue="coolifyEnvironment";break;case"application":{let t=this.rawData;this.iconPath=this.getAppIcon(t?.status),this.contextValue=`coolifyApp_${t?.status?.toLowerCase()??"unknown"}`,t?.fqdn&&(this.description=t.fqdn.replace(/^https?:\/\//,"")),this.tooltip=this.buildAppTooltip(t);break}case"server":{let t=this.rawData,i=t?.settings?.is_reachable;this.iconPath=new l.ThemeIcon(i?"server-process":"server-environment"),this.contextValue="coolifyServer",this.description=t?.ip;break}case"database":{let t=this.rawData;this.iconPath=new l.ThemeIcon("database"),this.contextValue=`coolifyDatabase_${t?.status?.toLowerCase()??"unknown"}`,this.description=t?.type;break}case"category":this.iconPath=new l.ThemeIcon("list-unordered"),this.contextValue="coolifyCategory";break;case"loading":this.iconPath=new l.ThemeIcon("loading~spin"),this.contextValue="coolifyLoading";break;case"empty":this.iconPath=new l.ThemeIcon("info"),this.contextValue="coolifyEmpty";break}}getAppIcon(t){switch(t?.toLowerCase()){case"running":return new l.ThemeIcon("vm-running",new l.ThemeColor("charts.green"));case"stopped":case"exited":return new l.ThemeIcon("vm-outline",new l.ThemeColor("charts.gray"));case"deploying":case"starting":return new l.ThemeIcon("sync~spin",new l.ThemeColor("charts.yellow"));case"error":case"failed":return new l.ThemeIcon("error",new l.ThemeColor("charts.red"));default:return new l.ThemeIcon("circle-outline")}}buildAppTooltip(t){if(!t)return new l.MarkdownString("No application data");let i=[`**${t.name}**`,"",`Status: \`${t.status??"unknown"}\``];return t.git_repository&&i.push(`Repo: \`${t.git_repository}\``),t.git_branch&&i.push(`Branch: \`${t.git_branch}\``),t.fqdn&&i.push(`URL: [${t.fqdn}](${t.fqdn})`),new l.MarkdownString(i.join(`
`))}},j=class{constructor(e){this.configManager=e}_onDidChangeTreeData=new l.EventEmitter;onDidChangeTreeData=this._onDidChangeTreeData.event;refreshInterval;isDisposed=!1;service;cachedProjects=[];cachedApplications=[];cachedServers=[];cachedDatabases=[];isConfigured=!1;async initialize(){await this.loadData(),this.startAutoRefresh()}startAutoRefresh(){let e=l.workspace.getConfiguration("coolify").get("refreshInterval",5e3);this.refreshInterval=setInterval(()=>{this.isDisposed||this.loadData().catch(console.error)},e)}async getService(){let e=await this.configManager.getServerUrl(),t=await this.configManager.getToken();return!e||!t?null:(this.service=new u(e,t),this.service)}async loadData(){if(this.isConfigured=await this.configManager.isConfigured(),!this.isConfigured){this.refresh();return}try{let e=await this.getService();if(!e)return;let[t,i,a,o]=await Promise.allSettled([e.getProjects(),e.getApplications(),e.getServers(),e.getDatabases()]);this.cachedProjects=t.status==="fulfilled"?t.value:[],this.cachedApplications=i.status==="fulfilled"?i.value:[],this.cachedServers=a.status==="fulfilled"?a.value:[],this.cachedDatabases=o.status==="fulfilled"?o.value:[],this.refresh()}catch(e){console.error("CoolifyTreeDataProvider: Failed to load data:",e)}}refresh(){this._onDidChangeTreeData.fire()}getTreeItem(e){return e}async getChildren(e){if(!this.isConfigured)return[new m("Not configured \u2014 run Coolify: Configure",l.TreeItemCollapsibleState.None,"empty")];if(!e)return[new m("Projects",l.TreeItemCollapsibleState.Expanded,"category"),new m("Applications",l.TreeItemCollapsibleState.Collapsed,"category"),new m("Servers",l.TreeItemCollapsibleState.Collapsed,"category"),new m("Databases",l.TreeItemCollapsibleState.Collapsed,"category")];if(e.kind==="category")return this.getCategoryChildren(e.label);if(e.kind==="project"){let t=e.rawData;return!t.environments||t.environments.length===0?[new m("No environments",l.TreeItemCollapsibleState.None,"empty")]:t.environments.map(i=>new m(i.name,l.TreeItemCollapsibleState.Collapsed,"environment",i,String(t.uuid)))}if(e.kind==="environment"){let t=e.rawData,i=this.cachedApplications.filter(a=>t.applications?t.applications.some(o=>o.id===a.id):!0);return i.length===0?[new m("No applications",l.TreeItemCollapsibleState.None,"empty")]:i.map(a=>new m(a.name,l.TreeItemCollapsibleState.None,"application",a))}return[]}getCategoryChildren(e){switch(e){case"Projects":return this.cachedProjects.length===0?[new m("No projects found",l.TreeItemCollapsibleState.None,"empty")]:this.cachedProjects.map(t=>new m(t.name,l.TreeItemCollapsibleState.Collapsed,"project",t));case"Applications":return this.cachedApplications.length===0?[new m("No applications found",l.TreeItemCollapsibleState.None,"empty")]:this.cachedApplications.map(t=>new m(t.name,l.TreeItemCollapsibleState.None,"application",t));case"Servers":return this.cachedServers.length===0?[new m("No servers found",l.TreeItemCollapsibleState.None,"empty")]:this.cachedServers.map(t=>new m(t.name,l.TreeItemCollapsibleState.None,"server",t));case"Databases":return this.cachedDatabases.length===0?[new m("No databases found",l.TreeItemCollapsibleState.None,"empty")]:this.cachedDatabases.map(t=>new m(t.name,l.TreeItemCollapsibleState.None,"database",t));default:return[]}}getService_(){return this.service}getCachedApplications(){return this.cachedApplications}getCachedDatabases(){return this.cachedDatabases}dispose(){this.isDisposed=!0,this.refreshInterval&&clearInterval(this.refreshInterval),this._onDidChangeTreeData.dispose()}};var w=y(require("vscode"));var C=y(require("vscode"));function J(s){try{!s.startsWith("http://")&&!s.startsWith("https://")&&(s="http://"+s);let e=new URL(s),t=e.hostname,i=t==="localhost"||/^(\d{1,3}\.){3}\d{1,3}$/.test(t)||t.includes(".");return t==="localhost"||/^(\d{1,3}\.){3}\d{1,3}$/.test(t)?!!e.port:i}catch{return!1}}function X(s){return!s.startsWith("http://")&&!s.startsWith("https://")&&(s="http://"+s),s.replace(/\/$/,"")}async function Z(s,e){try{let t=await C.window.showInputBox({ignoreFocusOut:!0,title:"Coolify \u2014 Step 1 of 2",prompt:"Enter your Coolify server URL",placeHolder:"e.g., https://coolify.my-server.com or http://127.0.0.1:8000",validateInput:g=>g?J(g)?null:"Invalid URL format":"Server URL is required"});if(!t)return;let i=X(t);if(!await new u(i,"").testConnection())throw new Error("Could not reach the Coolify server. Check the URL and try again.");let r=`${i}/security/api-tokens`,n=await C.window.showInformationMessage(`\u2705 Connected to Coolify at ${i.replace(/^https?:\/\//,"")}! Open the API token page in your browser?`,{modal:!1},"Open Token Page","I already have a token");n==="Open Token Page"&&await C.env.openExternal(C.Uri.parse(r));let c=await C.window.showInputBox({ignoreFocusOut:!0,title:"Coolify \u2014 Step 2 of 2",prompt:n==="Open Token Page"?"\u{1F510} Paste your API token from the browser tab that just opened":"Enter your Coolify API token",password:!0,placeHolder:"Paste API token here\u2026",validateInput:g=>g?null:"Token is required"});if(!c)return;if(!await new u(i,c).verifyToken())throw new Error("Invalid token \u2014 please check and try again.");await s.setServerUrl(i),await s.setToken(c),await e(),C.window.showInformationMessage("\u{1F389} Coolify configured! Your workspace is now connected.","Open Sidebar").then(g=>{g==="Open Sidebar"&&C.commands.executeCommand("coolify-deployments.focus")})}catch(t){C.window.showErrorMessage(t instanceof Error?t.message:"Configuration failed. Please try again.")}}async function O(s,e){await C.window.showWarningMessage("This will clear your existing Coolify configuration. Continue?","Yes, reconfigure","Cancel")==="Yes, reconfigure"&&(await s.clearConfiguration(),await e(),await C.commands.executeCommand("coolify.configure"))}var x=y(require("vscode"));async function ee(s){try{let e=await s.getServerUrl(),t=await s.getToken();if(!e||!t)throw new Error("Extension not configured properly");let i=new u(e,t),o=(await i.getDeployments()).filter(n=>n.status==="in_progress"||n.status==="queued");if(!o||o.length===0){x.window.showInformationMessage("No active deployments found");return}let r=await x.window.showQuickPick(o.map(n=>({label:`Cancel: ${n.application_name||"Deployment"}`,description:n.status,detail:n.commit_message||`Deployment ID: ${n.id}`,id:n.id})),{placeHolder:"Select a deployment to cancel",title:"Cancel Deployment"});r&&x.window.withProgress({location:x.ProgressLocation.Notification,title:`Canceling ${r.label}...`,cancellable:!1},async()=>{await i.cancelDeployment(r.id),x.window.showInformationMessage("Successfully canceled deployment.")})}catch(e){x.window.showErrorMessage(e instanceof Error?e.message:"Failed to cancel deployment")}}var I=y(require("vscode"));async function H(s,e,t,i,a){try{let o=await s.getServerUrl(),r=await s.getToken();if(!o||!r)throw new Error("Extension not configured properly");let n=new u(o,r),c=i,d=a;if(!c){let p=await n.getApplications();if(!p||p.length===0){I.window.showInformationMessage("No applications found");return}let g=await I.window.showQuickPick(p.map(h=>({label:h.name,description:h.status,detail:`Status: ${h.status}`,id:h.id||h.uuid||""})),{placeHolder:`Select an application to ${e}`,title:t});if(!g)return;c=g.id,d=g.label}await I.window.withProgress({location:I.ProgressLocation.Notification,title:`${e}ing ${d}...`,cancellable:!1},async()=>{e==="start"?await n.startApplication(c):e==="stop"?await n.stopApplication(c):await n.restartApplication(c),I.workspace.getConfiguration("coolify").get("enableNotifications",!0)&&I.window.showInformationMessage(`\u2705 Successfully ${e}ed ${d}`)})}catch(o){I.window.showErrorMessage(o instanceof Error?o.message:`Failed to ${e} application`)}}async function te(s,e,t,i){await H(e,"start","Start Application",t,i)}async function oe(s,e,t,i){await H(e,"stop","Stop Application",t,i)}async function ie(s,e,t,i){await H(e,"restart","Restart Application",t,i)}var b=y(require("vscode"));async function se(s,e,t,i,a){let o=i,r=a||"Database";if(!o){let p=await s.getServerUrl(),g=await s.getToken();if(!p||!g){b.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let h=new u(p,g),E=[];if(await b.window.withProgress({location:b.ProgressLocation.Notification,title:"Fetching databases..."},async()=>{E=await h.getDatabases()}),!E||E.length===0){b.window.showInformationMessage("No databases found.");return}let $=await b.window.showQuickPick(E.map(D=>({label:D.name,description:D.status,detail:D.type,id:D.uuid})),{placeHolder:`Select a database to ${e}`,title:t});if(!$)return;o=$.id,r=$.label}if(!o)return;let n=await s.getServerUrl(),c=await s.getToken();if(!n||!c){b.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let d=new u(n,c);await b.window.withProgress({location:b.ProgressLocation.Notification,title:`${t} for ${r}...`,cancellable:!1},async()=>{try{e==="start"?await d.startDatabase(o):e==="stop"&&await d.stopDatabase(o),b.workspace.getConfiguration("coolify").get("enableNotifications",!0)&&b.window.showInformationMessage(`\u2705 ${r} ${e} command sent successfully`)}catch(p){b.window.showErrorMessage(`Failed to ${e} ${r}`),console.error(`Error in database action (${e}):`,p)}})}async function K(s,e,t,i){await se(e,"start","Start Database",t,i)}async function q(s,e,t,i){await se(e,"stop","Stop Database",t,i)}var S=y(require("vscode"));var z;function ye(){return z||(z=S.window.createOutputChannel("Coolify Logs")),z}async function M(s,e){try{let t=await s.getServerUrl(),i=await s.getToken();if(!t||!i)throw new Error("Extension not configured properly");let a=new u(t,i),o=e?.id,r=e?.name;if(!o){let c=await a.getApplications();if(!c||c.length===0){S.window.showInformationMessage("No applications found");return}let d=await S.window.showQuickPick(c.map(p=>({label:p.name,description:p.status,detail:p.fqdn,id:p.id||p.uuid||""})),{placeHolder:"Select an application to view logs",title:"Coolify: View Logs"});if(!d)return;o=d.id,r=d.label}let n=ye();n.clear(),n.show(!0),n.appendLine(`\u2500\u2500 Coolify Logs \u2014 ${r} \u2500\u2500`),n.appendLine(`Fetching logs from ${t}...`),n.appendLine(""),await S.window.withProgress({location:S.ProgressLocation.Notification,title:`Fetching logs for ${r}...`,cancellable:!1},async()=>{let c=await a.getApplicationLogs(o);n.appendLine(c||"(No log output)")})}catch(t){S.window.showErrorMessage(t instanceof Error?t.message:"Failed to fetch logs")}}async function W(s,e){try{let t=await s.getServerUrl(),i=await s.getToken();if(!t||!i)throw new Error("Extension not configured properly");let a=new u(t,i),o=e?.id,r=e?.name;if(!o){let n=await a.getDatabases();if(!n||n.length===0){S.window.showInformationMessage("No databases found");return}let c=await S.window.showQuickPick(n.map(d=>({label:d.name,description:d.type,detail:d.status,id:d.uuid})),{placeHolder:"Select a database to back up",title:"Coolify: Create Database Backup"});if(!c)return;o=c.id,r=c.label}await S.window.withProgress({location:S.ProgressLocation.Notification,title:`Creating backup for ${r}...`,cancellable:!1},async()=>{await a.createDatabaseBackup(o),S.window.showInformationMessage(`\u2705 Backup created for ${r}`)})}catch(t){S.window.showErrorMessage(t instanceof Error?t.message:"Failed to create backup")}}var f=y(require("vscode"));async function ae(s,e,t){let i,a="";if(t?.kind==="application"&&t.rawData){let r=t.rawData;i=r.fqdn,a=r.name}else{let r=e.getCachedApplications().filter(c=>!!c.fqdn);if(r.length===0){f.window.showInformationMessage("No applications have a public URL configured in Coolify.");return}let n=await f.window.showQuickPick(r.map(c=>({label:c.name,description:c.fqdn.replace(/^https?:\/\//,""),detail:`Status: ${c.status??"unknown"}`,fqdn:c.fqdn})),{placeHolder:"Select an application to open",title:"Open in Browser"});if(!n)return;i=n.fqdn,a=n.label}if(!i){f.window.showWarningMessage(`${a} has no public URL configured in Coolify.`);return}let o=f.Uri.parse(i.startsWith("http")?i:`https://${i}`);await f.env.openExternal(o)}async function ne(s,e){let t,i="";if(e?.rawData){let a=e.rawData;t=a.uuid??a.uuid,i=a.name??a.name}else{let a=s.getCachedApplications(),o=s.getCachedDatabases(),r=[...a.map(c=>({label:c.name,description:`App \xB7 ${c.uuid}`,uuid:c.uuid})),...o.map(c=>({label:c.name,description:`DB \xB7 ${c.uuid}`,uuid:c.uuid}))];if(r.length===0){f.window.showInformationMessage("No resources found to copy UUID from.");return}let n=await f.window.showQuickPick(r,{placeHolder:"Select a resource to copy its UUID",title:"Copy UUID"});if(!n)return;t=n.uuid,i=n.label}if(!t){f.window.showWarningMessage("UUID not available for this resource.");return}await f.env.clipboard.writeText(t),f.window.showInformationMessage(`\u2705 UUID for "${i}" copied to clipboard!`)}async function re(s,e){let t=e.getCachedApplications();if(t.length===0){f.window.showInformationMessage("No applications found. Try refreshing.");return}let i=c=>{switch(c?.toLowerCase()){case"running":return"\u{1F7E2}";case"stopped":case"exited":return"\u{1F534}";case"deploying":case"starting":return"\u{1F7E1}";case"error":case"failed":return"\u274C";default:return"\u26AA"}},a=await f.window.showQuickPick(t.map(c=>({label:`${i(c.status)} ${c.name}`,description:c.fqdn?.replace(/^https?:\/\//,"")??"",detail:`Status: ${c.status??"unknown"} \xB7 ${c.git_branch?`Branch: ${c.git_branch}`:""}`,uuid:c.uuid??c.id??"",name:c.name})),{placeHolder:"Type to filter, select to deploy immediately",title:"\u26A1 Quick Deploy",matchOnDescription:!0,matchOnDetail:!0});if(!a)return;let o=await s.getServerUrl(),r=await s.getToken();if(!o||!r){f.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}let n=new u(o,r);await f.window.withProgress({location:f.ProgressLocation.Notification,title:`\u{1F680} Deploying ${a.name}\u2026`,cancellable:!1},async()=>{try{await n.startDeployment(a.uuid),f.window.showInformationMessage(`\u{1F680} ${a.name} deployment started!`,"View Logs").then(c=>{c==="View Logs"&&f.commands.executeCommand("coolify.viewApplicationLogs",{id:a.uuid,name:a.name})})}catch(c){f.window.showErrorMessage(`Deploy failed: ${c instanceof Error?c.message:String(c)}`)}})}async function ce(s){let e=await s.getServerUrl(),t=await s.getToken();if(!e||!t){f.window.showErrorMessage("Coolify is not configured. Run Coolify: Configure first.");return}await f.window.withProgress({location:f.ProgressLocation.Notification,title:"Testing Coolify connection\u2026",cancellable:!1},async()=>{try{let a=await new u(e,t).getVersion();f.window.showInformationMessage(`\u2705 Connected to Coolify v${a} at ${e.replace(/^https?:\/\//,"")}`)}catch(i){f.window.showErrorMessage(`\u274C Connection failed: ${i instanceof Error?i.message:String(i)}`)}})}var A=y(require("vscode"));function le(s,e,t){let i=A.extensions.getExtension("vscode.git");if(!i)return;let a=i.isActive?i.exports:null;if(!a)return;let o=a.getAPI(1);if(o?.repositories?.length)for(let r of o.repositories)s.subscriptions.push(r.state.onDidChange(async()=>{let n=r.state.HEAD?.name;if(!n||!await e.isConfigured())return;let d=t.getCachedApplications().filter(h=>h.git_branch===n&&h.status!=="deploying");if(d.length===0)return;let p=`coolify.gitAdvisor.${n}`,g=s.globalState.get(p)??0;if(!(Date.now()-g<3e4))if(await s.globalState.update(p,Date.now()),d.length===1){let h=d[0];await A.window.showInformationMessage(`Coolify: "${h.name}" is configured to deploy from \`${n}\`. Deploy now?`,"Deploy","Dismiss")==="Deploy"&&A.commands.executeCommand("coolify.startDeployment",{kind:"application",rawData:h})}else{let h=await e.getServerUrl(),E=await e.getToken();if(!h||!E)return;let $=await A.window.showQuickPick(d.map(D=>({label:D.name,description:D.fqdn??"",detail:`Branch: ${D.git_branch}`,uuid:D.uuid??D.id??""})),{title:`Deploy from ${n}?`,placeHolder:"Select an app to deploy (Escape to skip)"});if($){let D=new u(h,E);await A.window.withProgress({location:A.ProgressLocation.Notification,title:`\u{1F680} Deploying ${$.label}\u2026`,cancellable:!1},async()=>{await D.startDeployment($.uuid),A.window.showInformationMessage(`\u{1F680} ${$.label} deployment started!`)})}}}))}function de(s,e,t,i){let a=(o,r)=>s.subscriptions.push(w.commands.registerCommand(o,r));a("coolify.configure",()=>Z(e,i)),a("coolify.reconfigure",()=>O(e,i)),a("coolify.refreshApplications",async()=>{await t.loadData(),w.window.showInformationMessage("Coolify: Refreshed")}),a("coolify.startDeployment",(o,r)=>{if(typeof o=="string")return Q(e,o);if(o?.kind==="application"&&o.rawData){let n=o.rawData;return Q(e,n.id||n.uuid||"")}return Ce(e,t)}),a("coolify.cancelDeployment",()=>ee(e)),a("coolify.startApplication",(o,r)=>{if(typeof o=="string")return N(e,o,r||"Application","start");if(o?.kind==="application"&&o.rawData){let n=o.rawData;return N(e,n.id||n.uuid||"",n.name,"start")}return te(void 0,e)}),a("coolify.stopApplication",(o,r)=>{if(typeof o=="string")return N(e,o,r||"Application","stop");if(o?.kind==="application"&&o.rawData){let n=o.rawData;return N(e,n.id||n.uuid||"",n.name,"stop")}return oe(void 0,e)}),a("coolify.restartApplication",(o,r)=>{if(typeof o=="string")return N(e,o,r||"Application","restart");if(o?.kind==="application"&&o.rawData){let n=o.rawData;return N(e,n.id||n.uuid||"",n.name,"restart")}return ie(void 0,e)}),a("coolify.viewApplicationLogs",(o,r)=>{if(typeof o=="string")return M(e,{id:o,name:r||"Application"});if(o&&"kind"in o&&o.kind==="application"&&o.rawData){let n=o.rawData;return M(e,{id:n.id||n.uuid||"",name:n.name})}else if(o&&typeof o=="object"&&"id"in o)return M(e,o);return M(e)}),a("coolify.startDatabase",(o,r)=>{if(typeof o=="string")return K(void 0,e,o,r);if(o?.kind==="database"&&o.rawData){let n=o.rawData;return K(void 0,e,n.uuid,n.name)}return K(void 0,e)}),a("coolify.stopDatabase",(o,r)=>{if(typeof o=="string")return q(void 0,e,o,r);if(o?.kind==="database"&&o.rawData){let n=o.rawData;return q(void 0,e,n.uuid,n.name)}return q(void 0,e)}),a("coolify.createDatabaseBackup",(o,r)=>{if(typeof o=="string")return W(e,{id:o,name:r||"Database"});if(o?.kind==="database"&&o.rawData){let n=o.rawData;return W(e,{id:n.uuid,name:n.name})}return W(e)}),a("coolify.openInBrowser",o=>ae(e,t,o)),a("coolify.copyUuid",o=>ne(t,o)),a("coolify.quickDeploy",()=>re(e,t)),a("coolify.testConnection",()=>ce(e)),le(s,e,t)}async function Ce(s,e){let t=e.getCachedApplications();if(!t||t.length===0){w.window.showInformationMessage("No applications found");return}let i=await w.window.showQuickPick(t.map(a=>({label:a.name,description:a.status,detail:a.fqdn,id:a.id||a.uuid||""})),{placeHolder:"Select an application to deploy",title:"Start Deployment"});i&&await Q(s,i.id)}async function Q(s,e){let t=await s.getServerUrl(),i=await s.getToken();if(!t||!i)throw new Error("Not configured");let a=new u(t,i);await w.window.withProgress({location:w.ProgressLocation.Notification,title:"Starting deployment...",cancellable:!1},async()=>{await a.startDeployment(e),w.window.showInformationMessage("\u{1F680} Deployment started!")})}async function N(s,e,t,i){let a=await s.getServerUrl(),o=await s.getToken();if(!a||!o)throw new Error("Not configured");let r=new u(a,o);await w.window.withProgress({location:w.ProgressLocation.Notification,title:`${i}ing ${t}...`,cancellable:!1},async()=>{i==="start"?await r.startApplication(e):i==="stop"?await r.stopApplication(e):await r.restartApplication(e),w.workspace.getConfiguration("coolify").get("enableNotifications",!0)&&w.window.showInformationMessage(`\u2705 ${t} ${i}ed`)})}var T=y(require("vscode"));var be="coolify",Se="Coolify",pe="coolify.auth.sessions",F=class{constructor(e,t){this.context=e;this.configManager=t;this._reg=T.authentication.registerAuthenticationProvider(be,Se,this,{supportsMultipleAccounts:!1})}_sessions=[];_storedSessions=new Map;_onDidChangeSessions=new T.EventEmitter;onDidChangeSessions=this._onDidChangeSessions.event;_reg;async getSessions(e){return await this._load(),!e||e.length===0?this._sessions:this._sessions.filter(t=>e.every(i=>t.scopes.includes(i)))}async createSession(e){let t=await this.configManager.getServerUrl();if(!t){let o=await T.window.showInputBox({ignoreFocusOut:!0,title:"Connect to Coolify",prompt:"Enter your Coolify server URL",placeHolder:"https://coolify.my-server.com",validateInput:r=>r?null:"URL is required"});if(!o)throw new Error("Cancelled");t=o.replace(/\/$/,""),await this.configManager.setServerUrl(t)}await T.env.openExternal(T.Uri.parse(`${t}/security/api-tokens`));let i=await T.window.showInputBox({ignoreFocusOut:!0,title:"Coolify \u2014 Paste API Token",prompt:"\u{1F510} Paste your API token from the browser tab that just opened",password:!0,placeHolder:"Paste token here\u2026",validateInput:o=>o?null:"Token is required"});if(!i)throw new Error("Cancelled");if(!await new u(t,i).verifyToken())throw new Error("Invalid token \u2014 please check and try again.");return await this.configManager.setToken(i),this._storeSession(t,i,[...e])}async removeSession(e){let t=this._sessions.find(i=>i.id===e);this._sessions=this._sessions.filter(i=>i.id!==e),this._storedSessions.delete(e),await this._save(),await this.configManager.clearConfiguration(),t&&this._onDidChangeSessions.fire({added:[],removed:[t],changed:[]})}async createSessionFromToken(e,t){await this.configManager.setServerUrl(e),await this.configManager.setToken(t),this._storeSession(e,t,["coolify"])}_storeSession(e,t,i){let a=`coolify-${Date.now()}`,o=Array.from(i),r={id:a,accessToken:t,account:{id:e,label:e.replace(/^https?:\/\//,"")},scopes:o};return this._sessions=[r],this._storedSessions.set(a,{...r,scopes:o,serverUrl:e}),this._save(),this._onDidChangeSessions.fire({added:[r],removed:[],changed:[]}),r}async _load(){let e=this.context.globalState.get(pe,[]);this._sessions=e.map(t=>({id:t.id,accessToken:t.accessToken,account:t.account,scopes:t.scopes})),e.forEach(t=>this._storedSessions.set(t.id,t))}async _save(){await this.context.globalState.update(pe,[...this._storedSessions.values()])}dispose(){this._reg.dispose(),this._onDidChangeSessions.dispose()}};var P=y(require("vscode"));var Y=class{constructor(e,t,i){this.authProvider=e;this.configManager=t;this.onAuthenticated=i}async handleUri(e){let t=new URLSearchParams(e.query),i=t.get("token"),a=t.get("url"),o=e.path;if(o==="/auth"||o==="/callback"){if(!i||!a){P.window.showErrorMessage("Coolify: Invalid auth link \u2014 missing token or server URL.");return}let r=decodeURIComponent(a).replace(/\/$/,""),n=decodeURIComponent(i),c=new u(r,n);await P.window.withProgress({location:P.ProgressLocation.Notification,title:`\u{1F510} Authenticating with Coolify at ${r.replace(/^https?:\/\//,"")}\u2026`,cancellable:!1},async()=>{if(!await c.verifyToken()){P.window.showErrorMessage("Coolify: The token from the deep link is invalid or expired.");return}await this.authProvider.createSessionFromToken(r,n),await this.onAuthenticated(),P.window.showInformationMessage(`\u2705 Authenticated with Coolify at ${r.replace(/^https?:\/\//,"")}!`,"Open Sidebar").then(p=>{p==="Open Sidebar"&&P.commands.executeCommand("coolify-deployments.focus")})})}}};function De(){let s=v.env.appName??"",e=s.toLowerCase();return{name:s,isCursor:e.includes("cursor"),isTrae:e.includes("trae"),isWindsurf:e.includes("windsurf"),isVSCodium:e.includes("vscodium")||e.includes("codium"),isAntigravity:e.includes("antigravity")}}var _,L;function ke(s){let e=De();console.log(`[Coolify] Running in: ${e.name}`);let t=v.env.remoteName!==void 0&&v.env.remoteName!=="",i=s.globalState.get("coolify.remoteAdvisoryShown");t&&!i&&v.window.showInformationMessage(`Coolify: You are in a remote session (${v.env.remoteName}). Make sure your Coolify server is reachable FROM this remote host.`,"Got it").then(()=>{s.globalState.update("coolify.remoteAdvisoryShown",!0)});let a=`coolify.greeted.${e.name}`;if(!s.globalState.get(a)){let p=e.isAntigravity?"Antigravity":e.isCursor?"Cursor":e.isTrae?"Trae":e.isWindsurf?"Windsurf":e.isVSCodium?"VSCodium":"VS Code";v.window.showInformationMessage(`\u{1F44B} Coolify Deployments is ready in ${p}! Run "Coolify: Configure" to connect to your server.`,"Configure Now","Dismiss").then(g=>{g==="Configure Now"&&v.commands.executeCommand("coolify.configure")}),s.globalState.update(a,!0)}let o=new U(s);_=new j(o);let r=v.window.createTreeView("coolify-deployments",{treeDataProvider:_,showCollapseAll:!0});L=new V(o),s.subscriptions.push(r,{dispose:()=>_?.dispose()},{dispose:()=>L?.dispose()});async function n(){let p=await o.isConfigured();await v.commands.executeCommand("setContext","coolify.isConfigured",p),p?(await _?.loadData(),await L?.initialize()):_?.refresh()}n().then(()=>{_?.initialize(),L?.initialize()}),s.subscriptions.push(v.workspace.onDidChangeConfiguration(p=>{p.affectsConfiguration("coolify")&&n()})),de(s,o,_,n);let c=new F(s,o);s.subscriptions.push(c);let d=new Y(c,o,n);s.subscriptions.push(v.window.registerUriHandler(d))}function Ae(){_?.dispose(),L?.dispose()}0&&(module.exports={activate,deactivate});
